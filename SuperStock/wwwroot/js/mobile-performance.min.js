class MobilePerformanceOptimizer{constructor(){this.isMobile=this.detectMobile(),this.isLowEndDevice=this.detectLowEndDevice(),this.connectionType=this.getConnectionType(),this.lazyLoadObserver=null,this.intersectionObserver=null,this.init()}init(){this.isMobile&&(this.setupLazyLoading(),this.optimizeScrolling(),this.setupImageOptimization(),this.setupResourceHints(),this.setupServiceWorker(),this.handleOrientationChange(),this.optimizeTouchInteractions(),this.setupMemoryManagement())}detectMobile(){return/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768}detectLowEndDevice(){const e=navigator.deviceMemory||4,t=navigator.hardwareConcurrency||4,o=navigator.connection;return e<=2||t<=2||o&&("slow-2g"===o.effectiveType||"2g"===o.effectiveType)}getConnectionType(){const e=navigator.connection;return e?e.effectiveType:"unknown"}setupLazyLoading(){this.lazyLoadObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target;t.dataset.src&&(t.src=t.dataset.src,t.removeAttribute("data-src"),this.lazyLoadObserver.unobserve(t))}})},{rootMargin:"50px 0px",threshold:.01}),document.querySelectorAll("img[data-src]").forEach(e=>{this.lazyLoadObserver.observe(e)}),this.setupComponentLazyLoading()}setupComponentLazyLoading(){this.intersectionObserver=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target;t.classList.contains("chart-container")&&!t.dataset.loaded&&this.loadChart(t),t.classList.contains("table-container")&&!t.dataset.loaded&&this.loadTable(t),t.classList.contains("lottie-container")&&!t.dataset.loaded&&this.loadLottieAnimation(t)}})},{rootMargin:"100px 0px",threshold:.1}),document.querySelectorAll(".chart-container, .table-container, .lottie-container").forEach(e=>{e.dataset.loaded||this.intersectionObserver.observe(e)})}loadChart(e){e.dataset.loaded="true";const t=document.createElement("div");t.className="chart-loader",t.innerHTML='\n            <div class="loading-spinner">\n                <div class="spinner"></div>\n                <span>Loading chart...</span>\n            </div>\n        ',e.appendChild(t),setTimeout(()=>{t.remove(),window.initializeChart&&window.initializeChart(e)},500),this.intersectionObserver.unobserve(e)}loadTable(e){e.dataset.loaded="true";const t=e.querySelectorAll("tr[data-lazy]"),o=this.isLowEndDevice?10:20;this.loadTableBatch(t,0,o),this.intersectionObserver.unobserve(e)}loadTableBatch(e,t,o){const a=Math.min(t+o,e.length);for(let o=t;o<a;o++){const t=e[o];t.style.display="",t.removeAttribute("data-lazy")}a<e.length&&setTimeout(()=>{this.loadTableBatch(e,a,o)},50)}loadLottieAnimation(e){if(e.dataset.loaded="true",window.lottie&&e.dataset.animationPath){const t=window.lottie.loadAnimation({container:e,renderer:"svg",loop:"true"===e.dataset.loop,autoplay:"true"===e.dataset.autoplay,path:e.dataset.animationPath});e.lottieAnimation=t}this.intersectionObserver.unobserve(e)}optimizeScrolling(){let e;document.querySelectorAll(".modal-body, .table-container, .chart-container, .sidebar-content").forEach(e=>{e.style.webkitOverflowScrolling="touch",e.style.scrollBehavior="smooth"});window.addEventListener("scroll",()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.handleScrollOptimizations()},16)},{passive:!0})}handleScrollOptimizations(){window.scrollY;const e=window.innerHeight;document.querySelectorAll(".summary-card, .dashboard-section").forEach(t=>{const o=t.getBoundingClientRect(),a=o.bottom>=-e&&o.top<=2*e;a||t.dataset.hidden?a&&t.dataset.hidden&&(t.style.visibility="visible",delete t.dataset.hidden):(t.style.visibility="hidden",t.dataset.hidden="true")})}setupImageOptimization(){this.checkWebPSupport()&&document.querySelectorAll("img[data-webp]").forEach(e=>{e.src=e.dataset.webp}),"slow-2g"!==this.connectionType&&"2g"!==this.connectionType||this.loadLowQualityImages()}checkWebPSupport(){const e=document.createElement("canvas");return e.width=1,e.height=1,0===e.toDataURL("image/webp").indexOf("data:image/webp")}loadLowQualityImages(){document.querySelectorAll("img[data-low-quality]").forEach(e=>{e.src=e.dataset.lowQuality})}setupResourceHints(){["/css/site.css","/js/site.min.js"].forEach(e=>{const t=document.createElement("link");t.rel="preload",t.href=e,t.as=e.endsWith(".css")?"style":"script",document.head.appendChild(t)});["/Home/Leaderboard","/Home/Competition"].forEach(e=>{const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)})}setupServiceWorker(){"serviceWorker"in navigator&&!this.isLowEndDevice&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("ServiceWorker registered:",e)}).catch(e=>{console.log("ServiceWorker registration failed:",e)})}handleOrientationChange(){let e;window.addEventListener("orientationchange",()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.optimizeForOrientation()},200)})}optimizeForOrientation(){const e=90===window.orientation||-90===window.orientation;document.body.classList.toggle("landscape",e),document.body.classList.toggle("portrait",!e),this.resizeComponents(),window.dispatchEvent(new Event("resize"))}resizeComponents(){document.querySelectorAll(".chart-container canvas").forEach(e=>{e.chart&&e.chart.resize&&e.chart.resize()}),document.querySelectorAll(".table-responsive").forEach(e=>{e.style.display="none",e.offsetHeight,e.style.display=""})}optimizeTouchInteractions(){document.addEventListener("touchstart",()=>{},{passive:!0});document.querySelectorAll("button, .btn, .nav-link, .card-clickable").forEach(e=>{e.style.touchAction="manipulation",e.addEventListener("touchstart",t=>{e.classList.add("touch-active")},{passive:!0}),e.addEventListener("touchend",t=>{setTimeout(()=>{e.classList.remove("touch-active")},150)},{passive:!0}),e.addEventListener("touchcancel",t=>{e.classList.remove("touch-active")},{passive:!0})})}setupMemoryManagement(){navigator.deviceMemory&&navigator.deviceMemory<=2&&this.enableLowMemoryMode(),setInterval(()=>{this.cleanupResources()},3e4),"memory"in performance&&setInterval(()=>{const e=performance.memory;e.usedJSHeapSize/e.jsHeapSizeLimit>.8&&this.handleMemoryPressure()},1e4)}enableLowMemoryMode(){document.body.classList.add("low-memory-mode"),document.querySelectorAll(".lottie-container").forEach(e=>{e.lottieAnimation&&e.lottieAnimation.destroy()}),window.chartUpdateInterval&&(clearInterval(window.chartUpdateInterval),window.chartUpdateInterval=setInterval(window.updateCharts,1e4))}handleMemoryPressure(){window.gc&&window.gc(),this.clearCaches(),this.reduceActiveComponents()}clearCaches(){document.querySelectorAll("img").forEach(e=>{this.isElementVisible(e)||(e.src="")}),window.chartDataCache&&window.chartDataCache.clear()}reduceActiveComponents(){document.querySelectorAll(".lottie-container").forEach(e=>{!this.isElementVisible(e)&&e.lottieAnimation&&e.lottieAnimation.pause()}),document.querySelectorAll(".table tbody tr").forEach((e,t)=>{t>50&&!this.isElementVisible(e)&&(e.style.display="none")})}cleanupResources(){this.cleanupEventListeners(),this.cleanupDOMElements(),this.clearExpiredData()}cleanupEventListeners(){document.querySelectorAll("[data-cleanup-listeners]").forEach(e=>{document.contains(e)||(e.removeEventListener("click",e._clickHandler),e.removeEventListener("touchstart",e._touchHandler))})}cleanupDOMElements(){document.querySelectorAll("[data-temporary]").forEach(e=>{const t=parseInt(e.dataset.created);Date.now()-t>3e5&&e.remove()})}clearExpiredData(){for(let e=localStorage.length-1;e>=0;e--){const t=localStorage.key(e);if(t&&t.startsWith("cache_"))try{const e=JSON.parse(localStorage.getItem(t));e.expires&&Date.now()>e.expires&&localStorage.removeItem(t)}catch(e){localStorage.removeItem(t)}}}isElementVisible(e){const t=e.getBoundingClientRect();return t.bottom>=0&&t.top<=window.innerHeight}pauseNonCriticalAnimations(){document.querySelectorAll(".lottie-container").forEach(e=>{e.lottieAnimation&&!this.isElementVisible(e)&&e.lottieAnimation.pause()})}resumeAnimations(){document.querySelectorAll(".lottie-container").forEach(e=>{e.lottieAnimation&&this.isElementVisible(e)&&e.lottieAnimation.play()})}optimizeForBattery(){"getBattery"in navigator&&navigator.getBattery().then(e=>{e.level<.2&&this.enableBatterySaveMode(),e.addEventListener("levelchange",()=>{e.level<.2?this.enableBatterySaveMode():this.disableBatterySaveMode()})})}enableBatterySaveMode(){document.body.classList.add("battery-save-mode"),this.pauseNonCriticalAnimations(),window.dataUpdateInterval&&(clearInterval(window.dataUpdateInterval),window.dataUpdateInterval=setInterval(window.updateData,15e3))}disableBatterySaveMode(){document.body.classList.remove("battery-save-mode"),this.resumeAnimations(),window.dataUpdateInterval&&(clearInterval(window.dataUpdateInterval),window.dataUpdateInterval=setInterval(window.updateData,5e3))}}class MobileLayoutOptimizer{constructor(){this.init()}init(){this.setupMobileSpecificLayouts(),this.optimizeTableLayouts(),this.setupAdaptiveLayouts()}setupMobileSpecificLayouts(){window.innerWidth<=768&&(this.convertTablesToCards(),this.optimizeModalLayouts(),this.setupBottomSheets())}convertTablesToCards(){document.querySelectorAll(".table-mobile").forEach(e=>{const t=e.querySelector("tbody");if(!t)return;const o=t.querySelectorAll("tr"),a=e.querySelectorAll("thead th");o.forEach(e=>{const t=e.querySelectorAll("td"),o=document.createElement("div");o.className="mobile-table-card",t.forEach((e,t)=>{const i=document.createElement("div");i.className="card-row";const n=document.createElement("span");n.className="card-label",n.textContent=a[t]?.textContent||"";const r=document.createElement("span");r.className="card-value",r.innerHTML=e.innerHTML,i.appendChild(n),i.appendChild(r),o.appendChild(i)}),e.parentNode.insertBefore(o,e),e.style.display="none"})})}optimizeModalLayouts(){document.querySelectorAll(".modal").forEach(e=>{const t=e.querySelector(".modal-dialog");t&&!t.classList.contains("modal-fullscreen")&&t.classList.add("modal-fullscreen-sm-down")})}setupBottomSheets(){document.querySelectorAll('.modal[data-mobile="bottom-sheet"]').forEach(e=>{e.classList.add("bottom-sheet-modal")})}optimizeTableLayouts(){document.querySelectorAll("table").forEach(e=>{if(!e.closest(".table-responsive")){const t=document.createElement("div");t.className="table-responsive",e.parentNode.insertBefore(t,e),t.appendChild(e)}})}setupAdaptiveLayouts(){const e=window.matchMedia("(max-width: 768px)"),t=e=>{e.matches?this.enableMobileLayout():this.enableDesktopLayout()};e.addListener(t),t(e)}enableMobileLayout(){document.body.classList.add("mobile-layout"),document.body.classList.remove("desktop-layout"),document.querySelectorAll(".row").forEach(e=>{e.classList.add("mobile-stack")})}enableDesktopLayout(){document.body.classList.add("desktop-layout"),document.body.classList.remove("mobile-layout"),document.querySelectorAll(".row").forEach(e=>{e.classList.remove("mobile-stack")})}}document.addEventListener("DOMContentLoaded",()=>{window.mobilePerformanceOptimizer=new MobilePerformanceOptimizer,window.mobileLayoutOptimizer=new MobileLayoutOptimizer,window.mobilePerformanceOptimizer.isMobile&&window.mobilePerformanceOptimizer.optimizeForBattery()}),window.MobilePerformanceOptimizer=MobilePerformanceOptimizer,window.MobileLayoutOptimizer=MobileLayoutOptimizer;