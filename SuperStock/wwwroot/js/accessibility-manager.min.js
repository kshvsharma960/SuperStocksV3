class AccessibilityManager{constructor(){this.focusableElements=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])','[role="button"]:not([disabled])','[role="link"]:not([disabled])'].join(", "),this.init()}init(){this.setupKeyboardNavigation(),this.setupFocusManagement(),this.setupAriaLiveRegions(),this.setupSkipLinks(),this.enhanceFormAccessibility(),this.setupModalAccessibility(),this.setupTableAccessibility(),this.setupNotificationAccessibility(),this.setupChartAccessibility()}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{e.altKey&&"m"===e.key&&(e.preventDefault(),this.focusMainNavigation(),this.announceToScreenReader("Main navigation focused")),e.altKey&&"c"===e.key&&(e.preventDefault(),this.focusMainContent(),this.announceToScreenReader("Main content focused")),e.altKey&&"s"===e.key&&(e.preventDefault(),this.focusSearch(),this.announceToScreenReader("Search focused")),"Escape"===e.key&&this.handleEscapeKey()}),this.setupTabNavigation(),this.setupArrowKeyNavigation()}setupTabNavigation(){document.addEventListener("keydown",e=>{"Tab"===e.key&&(document.body.classList.add("keyboard-navigation"),setTimeout(()=>{document.body.classList.remove("mouse-navigation")},100))}),document.addEventListener("mousedown",()=>{document.body.classList.add("mouse-navigation"),document.body.classList.remove("keyboard-navigation")})}setupArrowKeyNavigation(){const e=document.querySelector(".nav-menu");e&&e.addEventListener("keydown",t=>{const a=e.querySelectorAll(".nav-link"),i=Array.from(a).indexOf(document.activeElement);if("ArrowDown"===t.key||"ArrowRight"===t.key){t.preventDefault();a[(i+1)%a.length].focus()}else if("ArrowUp"===t.key||"ArrowLeft"===t.key){t.preventDefault();a[i>0?i-1:a.length-1].focus()}}),this.setupTableNavigation()}setupTableNavigation(){document.querySelectorAll("table, .table-container").forEach(e=>{e.addEventListener("keydown",t=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End"].includes(t.key)&&(t.preventDefault(),this.navigateTable(t,e))})})}navigateTable(e,t){const a=t.querySelectorAll('td, th, [role="gridcell"], [role="columnheader"]'),i=document.activeElement.closest('td, th, [role="gridcell"], [role="columnheader"]');if(!i)return;const n=Array.from(a).indexOf(i),o=t.querySelectorAll('tr, [role="row"]'),r=i.closest('tr, [role="row"]'),s=Array.from(o).indexOf(r),c=r.querySelectorAll('td, th, [role="gridcell"], [role="columnheader"]'),l=Array.from(c).indexOf(i);let d=null;switch(e.key){case"ArrowRight":d=a[n+1];break;case"ArrowLeft":d=a[n-1];break;case"ArrowDown":if(s<o.length-1){const e=o[s+1].querySelectorAll('td, th, [role="gridcell"], [role="columnheader"]');d=e[Math.min(l,e.length-1)]}break;case"ArrowUp":if(s>0){const e=o[s-1].querySelectorAll('td, th, [role="gridcell"], [role="columnheader"]');d=e[Math.min(l,e.length-1)]}break;case"Home":d=c[0];break;case"End":d=c[c.length-1]}if(d){const e=d.querySelector(this.focusableElements)||d;(void 0===e.tabIndex||e.tabIndex<0)&&(e.tabIndex=0),e.focus()}}setupFocusManagement(){document.addEventListener("show.bs.modal",e=>{this.previousFocus=document.activeElement,setTimeout(()=>{this.setupFocusTrap(e.target),this.focusFirstElement(e.target)},100)}),document.addEventListener("hidden.bs.modal",()=>{this.previousFocus&&(this.previousFocus.focus(),this.previousFocus=null)})}setupFocusTrap(e){const t=e.querySelectorAll(this.focusableElements),a=t[0],i=t[t.length-1];e.addEventListener("keydown",e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===a&&(e.preventDefault(),i.focus()):document.activeElement===i&&(e.preventDefault(),a.focus()))})}focusFirstElement(e){const t=e.querySelector(this.focusableElements);t&&t.focus()}setupAriaLiveRegions(){if(!document.getElementById("aria-live-polite")){const e=document.createElement("div");e.id="aria-live-polite",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e)}if(!document.getElementById("aria-live-assertive")){const e=document.createElement("div");e.id="aria-live-assertive",e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e)}}announceToScreenReader(e,t="polite"){const a=document.getElementById(`aria-live-${t}`);a&&(a.textContent=e,setTimeout(()=>{a.textContent=""},1e3))}setupSkipLinks(){const e=document.createElement("div");e.className="skip-links",e.innerHTML='\n            <a href="#main-content" class="skip-link">Skip to main content</a>\n            <a href="#main-navigation" class="skip-link">Skip to navigation</a>\n            <a href="#search" class="skip-link">Skip to search</a>\n        ',document.body.insertBefore(e,document.body.firstChild)}enhanceFormAccessibility(){document.querySelectorAll("form").forEach(e=>{e.querySelectorAll("input, select, textarea").forEach(t=>{if(!t.getAttribute("aria-label")&&!t.getAttribute("aria-labelledby")){const a=e.querySelector(`label[for="${t.id}"]`);a&&(t.setAttribute("aria-labelledby",a.id||this.generateId("label")),a.id||(a.id=t.getAttribute("aria-labelledby")))}t.required&&t.setAttribute("aria-required","true"),t.addEventListener("invalid",()=>{t.setAttribute("aria-invalid","true")}),t.addEventListener("input",()=>{t.checkValidity()&&t.removeAttribute("aria-invalid")})})})}setupModalAccessibility(){document.querySelectorAll(".modal").forEach(e=>{e.getAttribute("role")||e.setAttribute("role","dialog"),e.getAttribute("aria-modal")||e.setAttribute("aria-modal","true");const t=e.querySelector(".modal-title, h1, h2, h3, h4, h5, h6");t&&!e.getAttribute("aria-labelledby")&&(t.id||(t.id=this.generateId("modal-title")),e.setAttribute("aria-labelledby",t.id))})}setupTableAccessibility(){document.querySelectorAll("table").forEach(e=>{if(e.getAttribute("role")||e.setAttribute("role","table"),!e.querySelector("caption")&&!e.getAttribute("aria-label")){const t=e.closest(".dashboard-section")?.querySelector(".section-title");t&&e.setAttribute("aria-label",t.textContent.trim())}e.querySelectorAll("th").forEach(e=>{e.getAttribute("scope")||e.setAttribute("scope","col")}),(void 0===e.tabIndex||e.tabIndex<0)&&(e.tabIndex=0)})}setupNotificationAccessibility(){new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&(e.classList?.contains("toast")||e.classList?.contains("notification"))&&this.enhanceNotification(e)})})}).observe(document.body,{childList:!0,subtree:!0})}enhanceNotification(e){e.setAttribute("role","alert"),e.setAttribute("aria-live","assertive"),e.tabIndex=0,(e.classList.contains("error")||e.classList.contains("warning"))&&e.focus();const t=e.textContent||e.innerText;this.announceToScreenReader(t,"assertive")}setupChartAccessibility(){document.querySelectorAll('canvas[id*="chart"], .chart-container').forEach(e=>{e.getAttribute("aria-label")||e.setAttribute("aria-label","Stock price chart"),e.setAttribute("role","img"),(void 0===e.tabIndex||e.tabIndex<0)&&(e.tabIndex=0),e.addEventListener("keydown",t=>{this.handleChartKeyboard(t,e)})})}handleChartKeyboard(e,t){const a=Chart.getChart(t);if(a)switch(e.key){case"ArrowLeft":e.preventDefault(),this.announceToScreenReader("Moving to previous data point");break;case"ArrowRight":e.preventDefault(),this.announceToScreenReader("Moving to next data point");break;case"Enter":case" ":e.preventDefault(),this.announceChartData(a)}}announceChartData(e){const t=e.data;if(t&&t.datasets&&t.datasets.length>0){const e=t.datasets[0],a=`Current stock price: ${e.data[e.data.length-1]}`;this.announceToScreenReader(a,"assertive")}}focusMainNavigation(){const e=document.querySelector("#main-navigation, .nav-menu, .sidebar");if(e){const t=e.querySelector("a, button");t&&t.focus()}}focusMainContent(){const e=document.querySelector("#main-content, main, .main-content");e&&((void 0===e.tabIndex||e.tabIndex<0)&&(e.tabIndex=-1),e.focus())}focusSearch(){const e=document.querySelector('#search, .search-input, input[type="search"]');e&&e.focus()}handleEscapeKey(){const e=document.querySelector(".modal.show");if(e){const t=bootstrap.Modal.getInstance(e);return void(t&&t.hide())}const t=document.querySelector(".dropdown-menu.show");if(t){const e=bootstrap.Dropdown.getInstance(t.previousElementSibling);return void(e&&e.hide())}const a=document.querySelector(".sidebar.show");a&&(a.classList.remove("show"),document.body.classList.remove("sidebar-open"))}generateId(e="element"){return`${e}-${Math.random().toString(36).substr(2,9)}`}checkColorContrast(e,t){const a=this.hexToRgb(e),i=this.hexToRgb(t);if(!a||!i)return!1;const n=this.getRelativeLuminance(a),o=this.getRelativeLuminance(i);return(Math.max(n,o)+.05)/(Math.min(n,o)+.05)>=4.5}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}getRelativeLuminance(e){const{r:t,g:a,b:i}=e,[n,o,r]=[t,a,i].map(e=>(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4));return.2126*n+.7152*o+.0722*r}validateAccessibility(){const e=[];document.querySelectorAll("img").forEach((t,a)=>{t.alt||t.getAttribute("aria-label")||e.push(`Image ${a+1} missing alt text`)});document.querySelectorAll("input, select, textarea").forEach((t,a)=>{t.getAttribute("aria-label")||t.getAttribute("aria-labelledby")||document.querySelector(`label[for="${t.id}"]`)||e.push(`Form input ${a+1} missing label`)});const t=document.querySelectorAll("h1, h2, h3, h4, h5, h6");let a=0;return t.forEach((t,i)=>{const n=parseInt(t.tagName.charAt(1));n>a+1&&e.push(`Heading level skipped at heading ${i+1}`),a=n}),e}}document.addEventListener("DOMContentLoaded",()=>{window.accessibilityManager=new AccessibilityManager}),"undefined"!=typeof module&&module.exports&&(module.exports=AccessibilityManager);